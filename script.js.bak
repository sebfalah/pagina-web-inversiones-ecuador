const leadForm = document.getElementById("leadForm");
const formMessage = document.getElementById("formMessage");

if (leadForm && formMessage) {
  leadForm.addEventListener("submit", (event) => {
    event.preventDefault();

    const data = new FormData(leadForm);
    const nombre = (data.get("nombre") || "").toString().trim();
    const correo = (data.get("correo") || "").toString().trim();
    const capital = Number(data.get("capital"));

    if (!nombre || !correo || !capital || capital < 5000) {
      formMessage.textContent = "Revisa los datos. El capital minimo sugerido es USD 5,000.";
      return;
    }

    formMessage.textContent = "Gracias. Recibimos tus datos y te contactaremos pronto.";
    leadForm.reset();
  });
}

const prospectForm = document.getElementById("prospectForm");
const prospectMessage = document.getElementById("prospectMessage");

if (prospectForm && prospectMessage) {
  prospectForm.addEventListener("submit", async (event) => {
    event.preventDefault();

    const data = new FormData(prospectForm);
    const edad = Number(data.get("edad"));
    const capital = Number(data.get("capital"));
    const objetivos = data.getAll("objetivos");

    if (!edad || edad < 18 || edad > 100) {
      prospectMessage.textContent = "Ingresa una edad valida entre 18 y 100 anos.";
      return;
    }

    if (objetivos.length === 0) {
      prospectMessage.textContent = "Selecciona al menos un objetivo de inversion.";
      return;
    }

    if (!capital || capital < 5000) {
      prospectMessage.textContent = "El monto minimo sugerido para iniciar es USD 5,000.";
      return;
    }

    prospectMessage.textContent = "Enviando perfil...";

    try {
      const response = await fetch("save_prospect.php", {
        method: "POST",
        body: data,
      });

      const result = await response.json().catch(() => ({ ok: false }));

      if (!response.ok || !result.ok) {
        const debugSuffix = result.debug ? ` (${result.debug})` : "";
        prospectMessage.textContent = (result.message || "No se pudo guardar tu perfil. Intenta nuevamente.") + debugSuffix;
        return;
      }

      prospectMessage.textContent = "Gracias. Tu perfil fue guardado y te contactaremos con una propuesta inicial.";
      prospectForm.reset();
    } catch (error) {
      prospectMessage.textContent = "Error de conexion. Verifica el servidor e intenta nuevamente.";
    }
  });
}

